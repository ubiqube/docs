plugins {
    id 'org.asciidoctor.jvm.convert' version '3.2.0'
    id 'org.asciidoctor.jvm.gems' version '3.2.0'
    id 'org.asciidoctor.jvm.pdf' version '3.2.0'	
}
apply plugin: 'java'

repositories {
    jcenter()
    ruby.gems()
}

dependencies {
  asciidoctorGems 'rubygems:rouge:3.15.0'
}

asciidoctor.doFirst {
    delete file('build/html')
    delete file('build/pdf')
}


asciidoctor {
  
  options doctype: 'book'

  attributes \
  	'source-highlighter' : 'rouge',
    'linkcss': true,
    'product_name': 'MSActivator(TM)',
    'product_name-version': 'MSActivator-2.3.0 RC1',
    'openmsa_name': 'OpenMSA(TM)',
    'revnumber': 'MSA-2.3.0rc1',
    'revnumber-prev': 'MSA-2.2.0',
    'allow-uri-read': '',
    'sectlinks': true,
    'html': 'true',
    'format': 'html',
    'icons' : 'font'


  sourceDir = file('doc-src')
  outputDir  file('build/html')

  resources {
    from('doc-src') {
      include '**/*.png'
      include '**/*.jpg'
      include '**/*.mp4'
      include '**/*.css'
      include '**/*.html'
    }

    into '.'
  }
}

asciidoctorPdf {
  dependsOn asciidoctorGemsPrepare

  baseDirFollowsSourceFile()
  outputs.upToDateWhen { false }
  
  asciidoctorj {

    modules {
        pdf.version '1.5.3'
    }
    requires 'rouge'

    options doctype: 'book'

    attributes \
 	    'source-highlighter' : 'rouge',
      'linkcss': true,
      'product_name': 'MSActivator(TM)',
      'product_name-version': 'MSActivator-2.3.0 RC1',
      'openmsa_name': 'OpenMSA(TM)',
      'revnumber': 'MSA-2.3.0rc1',
      'revnumber-prev': 'MSA-2.2.0',
      'allow-uri-read': '',
      'sectlinks': true,
      'pdf': 'true',
      'format': 'html',
      'icons' : 'font',
      'page-background-image' : 'image:bg.jpg[fit=cover,pdfwidth=100%,position=top]'
  }

  sourceDir  file('doc-src')
  sources {
    include 'user-guide/manager-guide-single.adoc', 'admin-guide/admin-guide-single.adoc', 'developer-guide/developer-guide-single.adoc', 'release-notes/release_notes.adoc'
  }
  outputDir  file('build/pdf')

  resources {
    from('doc-src') {
      include '**/*.png'
      include '**/*.jpg'
      include '**/*.mp4'
      include '**/*.html'
    }

    into '.'
  }

}

// alias
//task asciidoc(dependsOn: asciidoctor)
task asciidoc_pdf(dependsOn: asciidoctorPdf)

//task asciidoc_all(dependsOn: asciidoctor, asciidoctorPdf)